<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <title>Leave Form</title>
  <style>
    body {
      background-color: #f4f6f8;
    }
    .leave-container {
      max-width: 900px;
      margin: 40px auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
    }
    .leave-container h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #2c3e50;
    }
    .leave-container .m-2 {
      font-weight: 500;
    }
    .leave-container input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .btn-submit {
      background-color: #2c3e50;
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      text-align: center;
      cursor: pointer;
    }
    .btn-submit:hover {
      background-color: #2c3e50;
    }
    .header-banner {
      background-color: #2c3e50;
      color: white;
      padding: 25px 0;
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
    <h2 class="header-banner m-4">Leave Form</h2>
  <div class="leave-container">
    
    <div class="m-2">Employee name: <input type="text" id="empName" minlength="5" maxlength="30" oninput="validationsText('empName','Name')" />
     <div id="empNameError" style="color:red" ></div></div>
    <div class="m-2">Employee ID: <input type="text" id="empId" maxlength="7" minlength="7" oninput="validationId()" style="text-transform: uppercase;" />
    <div id="empIdError" style="color:red"></div></div>
    <div class="m-2">Leave type: <input type="text" id="leaveType" oninput="validationsText('leaveType','Leave')" />
    <div id="leaveTypeError" style="color:red"></div></div>
    <div class="m-2">Start date: <input type="date" id="startDate" oninput="validateLeaveDates()" />
    <div id="startDateError" style="color: red;"></div></div>
    <div class="m-2">End date: <input type="date" id="endDate" oninput="validateLeaveEndDates()" />
    <div id="endDateError" style="color: red;"></div></div>
    <div class="m-2">Reason: <input type="text" id="reason" oninput="validationsText('reason','Reason')" minlength="5" maxlength="300" />
    <div id="reasonError" style="color : red"></div></div>
    <div class="m-2 text-center">
      <div class="btn-submit" onclick="saveLeaveData()">Submit</div>
    </div>
  </div>

  <script>
   async function saveLeaveData() {
  const empName=document.getElementById('empName').value;    
  const empId = document.getElementById('empId').value;
  const leaveType = document.getElementById('leaveType').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  const reason = document.getElementById('reason').value;
  if(empName=='' || empId=='' || leaveType=="" || startDate == "" || endDate=="" || reason =="" ){
    alert("Enter the all the Fields")
  }
else{
  const leaveData = {
    empName:empName,
    empId: empId,
    leaveType: leaveType,
    startDate: startDate,
    endDate: endDate,
    reason: reason
  };

  let leaveArray = [];

  try {
    const response = await fetch('http://localhost:8080/api/leaves', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(leaveData)
    });

    if (response.ok) {
      const saved = await response.json();
      alert(`Leave saved! Status: ${saved.status}`);
      document.querySelectorAll('input').forEach(i => i.value = '');
    } else {
      const text = await response.text();
      alert(`Server error (${response.status}): ${text}`);
    }
  } catch (err) {
    console.error(err);
    alert(`Network error: ${err.message}`);
  }
}
}
/// Validations
function validationsText(id, field) {
  var textName = document.getElementById(id);
  var error = document.getElementById(id + "Error");
  var value = textName.value.trim();
  var regex = /^[a-zA-Z/\s]{5,30}$/;

  if (!regex.test(value) && field != 'Reason') {
    error.textContent = field + " should be minimum of 5 letters and maximum of 30 characters.";
  }
  else if(!regex.test(value) && field == 'Reason'){
    error.textContent = field + " should be minimum of 5 letters and maximum of 300 characters.";

  } else {
    error.textContent = "";
  }
}


function validationId() {
  var inputField = document.getElementById('empId');
  var error = document.getElementById('empIdError');

  // Convert to uppercase
  inputField.value = inputField.value.toUpperCase();
  var textId = inputField.value;
  var regex = /^ATS0(?!000$)\d{3}$/;

  if (!regex.test(textId)) {
    error.textContent = "Invalid Employee ID. Format should be ATS0 and not end with 000";
  } else {
    error.textContent = ""; 
  }
}

function validateLeaveDates() {
  var startDate = new Date(document.getElementById("startDate").value);
  // var endDate = new Date(document.getElementById(endDateId).value);
  var today = new Date();
  
  // Set the time to 00:00:00 for comparison
  today.setHours(0, 0, 0, 0);
  startDate.setHours(0, 0, 0, 0);
  // endDate.setHours(0, 0, 0, 0);
  
  if (startDate < today) {
    document.getElementById("startDate").style.border = "1px solid red";
    document.getElementById("startDateError").textContent = "Start date should be today or in the future.";
  
  } else {
    document.getElementById("startDate").style.border = "";
    document.getElementById("startDateError").textContent = "";
  }
}


  function validateLeaveEndDates() {
    // console.log("hi")
  var startDate = new Date(document.getElementById("startDate").value);
   var endDate = new Date(document.getElementById("endDate").value);
  var today = new Date();
  startDate.setHours(0, 0, 0, 0);
  endDate.setHours(0, 0, 0, 0);
  today.setHours(0,0,0,0);
  
  // console.log(startDate.getTime());
  // console.log(endDate.getTime());
  
  if (endDate < startDate) {
    document.getElementById("endDate").style.border = "1px solid red";
    document.getElementById("endDateError").textContent = "End date should be after the start date.";
    
  } else {
    document.getElementById("endDate").style.border = "";
    document.getElementById("endDateError").textContent = "";
  }
}
  


  </script>
</body>
</html>